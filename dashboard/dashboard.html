<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Kamera PPE</title>

    <!-- Styles -->
    <link rel="stylesheet" href="/navbar/navbar.css" />
    <link rel="stylesheet" href="dashboard.css" />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f0f2f5;
      }
      .main-content {
        padding: 20px;
      }
      .camera-info-container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .camera-view,
      .info-panel {
        background: #1f2937;
        color: #fff;
        border-radius: 10px;
        padding: 20px;
        flex: 1;
      }
      .stream-buttons {
        margin-bottom: 10px;
      }
      .stream-buttons button {
        margin-right: 10px;
        padding: 6px 12px;
        border: none;
        border-radius: 5px;
        background: #3b82f6;
        color: #fff;
        cursor: pointer;
      }
      .stream-buttons button:hover {
        background: #2563eb;
      }
      #kameraUtama {
        width: 100%;
        height: 360px;
        border-radius: 10px;
        background: #000;
        border: none;
      }
      #message {
        color: #fff;
        font-weight: bold;
        margin-top: 10px;
      }
      .stats-container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .stat-card {
        flex: 1;
        background: #1e40af;
        color: #facc15;
        border-radius: 10px;
        text-align: center;
        padding: 20px;
      }
      .chart-section {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
      }
      .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <div class="main-content">
      <h1 style="text-align: center; margin-bottom: 20px">
        Dashboard Kamera PPE
      </h1>

      <div class="camera-info-container">
        <!-- Kamera View -->
        <div class="camera-view">
          <h2>Kamera¬†1</h2>
          <div class="stream-buttons">
            <button id="btnHD">Tampilkan¬†HD</button>
            <button id="btnSD">Tampilkan¬†SD</button>
          </div>
          <iframe id="kameraUtama" src="" allowfullscreen></iframe>
          <div id="message"></div>

          <!-- Hasil Analisis AI -->
          <p
            id="hasilAnalisis"
            style="color: #facc15; font-weight: bold; margin-top: 10px"
          >
            Menunggu hasil analisis AI...
          </p>
        </div>

        <!-- Info Panel -->
        <div class="info-panel">
          <h3>Informasi Kamera</h3>
          <ul style="list-style: none; padding: 0; margin: 0">
            <li>
              <strong>Device Name:</strong>
              <span id="deviceName">PPE-Cam-01</span>
            </li>
            <li>
              <strong>Event ID:</strong> <span id="eventId">EVT123456</span>
            </li>
            <li>
              <strong>Camera ID:</strong> <span id="cameraId">CAM001</span>
            </li>
            <li>
              <strong>Date:</strong> <span id="date">9/7/2025,¬†23:24:33</span>
            </li>
            <li>
              <strong>Modules:</strong>
              <span id="modules">Helm,¬†Rompi,¬†Masker</span>
            </li>
            <li>
              <strong>Location:</strong>
              <span id="location">Workshop¬†Area¬†1</span>
            </li>
            <li>
              <strong>Results:</strong>
              <span id="results">Pelanggaran¬†Terdeteksi</span>
            </li>
            <li>
              <strong>5 Snapshot Terbaru:</strong>
              <div
                id="snapshotContainer"
                style="display: flex; gap: 5px; margin-top: 5px"
              ></div>
            </li>
          </ul>
        </div>
      </div>

      <!-- Stats -->
      <div class="stats-container">
        <div class="stat-card">
          <h3>Pelanggaran Hari Ini</h3>
          <p id="stat-hari" style="font-size: 2em">12</p>
        </div>
        <div class="stat-card">
          <h3>Pelanggaran Minggu Ini</h3>
          <p id="stat-minggu" style="font-size: 2em">54</p>
        </div>
        <div class="stat-card">
          <h3>Pelanggaran Bulan Ini</h3>
          <p id="stat-bulan" style="font-size: 2em">132</p>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-section">
        <div class="chart-header">
          <h2>Grafik Pelanggaran</h2>
          <select id="filterSelect">
            <option value="weekly" selected>Mingguan</option>
            <option value="daily">Harian</option>
            <option value="monthly">Bulanan</option>
            <option value="all">Semua</option>
          </select>
        </div>
        <canvas id="violationChart" height="120"></canvas>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Navbar
        fetch("/navbar/navbar.html")
          .then((r) => r.text())
          .then((html) => {
            document.getElementById("navbar-container").innerHTML = html;
            const s = document.createElement("script");
            s.src = "/navbar/navbar.js";
            document.body.appendChild(s);
          });

        // Stream Buttons
        const iframe = document.getElementById("kameraUtama");
        const msg = document.getElementById("message");
        document.getElementById("btnHD").onclick = () => {
          iframe.src = "http://100.81.27.112:8889/live-stream-hd/";
          msg.innerText = "üîÑ Memuat HD...";
        };
        document.getElementById("btnSD").onclick = () => {
          iframe.src = "http://100.81.27.112:8889/live-stream-sd/";
          msg.innerText = "üîÑ Memuat SD...";
        };
        // default HD
        iframe.src = "http://100.81.27.112:8889/live-stream-hd/";
        msg.innerText = "üîÑ Memuat HD...";

        // Chart dummy data
        const ctx = document.getElementById("violationChart");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Sen", "Sel", "Rab", "Kam", "Jum", "Sab", "Min"],
            datasets: [
              {
                label: "Pelanggaran",
                data: [5, 8, 6, 10, 7, 12, 9],
              },
            ],
          },
        });

        // üîç Panggil AI dari Flask
        fetch("http://localhost:5000/analyze", {
          method: "POST",
        })
          .then((res) => res.json())
          .then((data) => {
            const hasil = document.getElementById("hasilAnalisis");
            if (data.status === "lengkap") {
              hasil.innerText = "‚úÖ Lengkap - Lampu hijau menyala";
              hasil.style.color = "#22c55e";
            } else {
              hasil.innerText = "‚ùå Tidak Lengkap - Suara peringatan aktif";
              hasil.style.color = "#ef4444";
            }
          })
          .catch((err) => {
            console.error("‚ùå Gagal panggil API:", err);
            document.getElementById("hasilAnalisis").innerText =
              "‚ö†Ô∏è Gagal memuat hasil AI.";
          });
      });
    </script>
    <script src="dashboard.js"></script>
  </body>
</html>
